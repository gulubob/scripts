--if you wanna mod this, atleast give me credits--

--I DIDNT USE CHATGPT TO MAKE THIS, I PUT COMMENTS FOR SCRIPT MODDERS--

local player = game.Players.LocalPlayer
local cam = workspace.CurrentCamera
local uis = game:GetService("UserInputService")
local run = game:GetService("RunService")
local Players = game:GetService("Players")

print("freecam executed, og script made by gulubob on tiktok, discord and github, unkn0wn_c0rpx3 on roblox")

--[[
    FORCE CHAT / BILLBOARDGUIS TO RENDER AT ANY DISTANCE 
--]]

-- function to set a GUI always visible
local function makeBillboardAlwaysVisible(gui)
    if gui and gui:IsA("BillboardGui") then
        gui.MaxDistance = math.huge
        gui.AlwaysOnTop = true
    end
end

-- force existing GUIs once
for _, obj in ipairs(workspace:GetDescendants()) do
    makeBillboardAlwaysVisible(obj)
end

-- force existing player name tags
for _, plr in ipairs(Players:GetPlayers()) do
    if plr.Character and plr.Character:FindFirstChild("Head") then
        for _, gui in ipairs(plr.Character.Head:GetChildren()) do
            makeBillboardAlwaysVisible(gui)
        end
    end
end

-- listen for new GUIs added to workspace
workspace.DescendantAdded:Connect(makeBillboardAlwaysVisible)

-- listen for new players and their respawns
Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(function(char)
        if char:FindFirstChild("Head") then
            for _, gui in ipairs(char.Head:GetChildren()) do
                makeBillboardAlwaysVisible(gui)
            end
        end
    end)
end)

--[[
    POPUP GUI (8.5 seconds)
--]]
local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local TextLabel = Instance.new("TextLabel")

ScreenGui.Parent = player:WaitForChild("PlayerGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.fromRGB(97, 0, 124)
Frame.BorderColor3 = Color3.fromRGB(0, 0, 0)
Frame.BorderSizePixel = 0
Frame.Position = UDim2.new(0.450286806, 0, 0.264819592, 0)
Frame.Size = UDim2.new(0, 261, 0, 132)

UICorner.Parent = Frame

TextLabel.Parent = Frame
TextLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
TextLabel.BackgroundTransparency = 1
TextLabel.BorderColor3 = Color3.fromRGB(0, 0, 0)
TextLabel.BorderSizePixel = 0
TextLabel.Position = UDim2.new(0.042145595, 0, 0.0454545468, 0)
TextLabel.Size = UDim2.new(0, 241, 0, 118)
TextLabel.Font = Enum.Font.Unknown
TextLabel.Text = "Script loaded! Press the Ctrl button on the right side of your keyboard to activate freecam. To move the camera, hold right click."
TextLabel.TextColor3 = Color3.fromRGB(0, 0, 0)
TextLabel.TextScaled = true
TextLabel.TextSize = 14
TextLabel.TextWrapped = true

task.delay(8.5, function()
    ScreenGui:Destroy()
end)

--[[
    FREECAM VARIABLES
--]]
local enabled = false
local speed = 1.5      -- movement speed
local sensitivity = 0.2 -- camera rotation speed
local move = Vector3.zero
local looking = false
local yaw = 0
local pitch = 0
local oldwalk, oldjump

--[[
    FREEZE/UNFREEZE CHARACTER
--]]
local function setcharlock(state)
    local char = player.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum then return end

    if state then
        oldwalk = hum.WalkSpeed
        oldjump = hum.JumpPower
        hum.WalkSpeed = 0
        hum.JumpPower = 0
    else
        if oldwalk then hum.WalkSpeed = oldwalk end
        if oldjump then hum.JumpPower = oldjump end
    end
end

--[[
    INPUT HANDLERS
--]]
uis.InputBegan:Connect(function(input, g)
    if g then return end

    -- toggle freecam with Right Ctrl
    if input.KeyCode == Enum.KeyCode.RightControl then
        enabled = not enabled
        if enabled then
            cam.CameraType = Enum.CameraType.Scriptable
            local x, y = cam.CFrame:ToOrientation()
            pitch = math.deg(x)
            yaw = math.deg(y)
            setcharlock(true)
        else
            cam.CameraType = Enum.CameraType.Custom
            setcharlock(false)
            uis.MouseBehavior = Enum.MouseBehavior.Default
        end
    end

    if enabled then
        if input.UserInputType == Enum.UserInputType.MouseButton2 then
            looking = true
            uis.MouseBehavior = Enum.MouseBehavior.LockCurrentPosition
        end

        if input.KeyCode == Enum.KeyCode.W then move += Vector3.new(0,0,-1) end
        if input.KeyCode == Enum.KeyCode.S then move += Vector3.new(0,0,1) end
        if input.KeyCode == Enum.KeyCode.A then move += Vector3.new(-1,0,0) end
        if input.KeyCode == Enum.KeyCode.D then move += Vector3.new(1,0,0) end
        if input.KeyCode == Enum.KeyCode.E then move += Vector3.new(0,1,0) end
        if input.KeyCode == Enum.KeyCode.Q then move += Vector3.new(0,-1,0) end
    end
end)

uis.InputEnded:Connect(function(input)
    if enabled then
        if input.UserInputType == Enum.UserInputType.MouseButton2 then
            looking = false
            uis.MouseBehavior = Enum.MouseBehavior.Default
        end

        if input.KeyCode == Enum.KeyCode.W then move -= Vector3.new(0,0,-1) end
        if input.KeyCode == Enum.KeyCode.S then move -= Vector3.new(0,0,1) end
        if input.KeyCode == Enum.KeyCode.A then move -= Vector3.new(-1,0,0) end
        if input.KeyCode == Enum.KeyCode.D then move -= Vector3.new(1,0,0) end
        if input.KeyCode == Enum.KeyCode.E then move -= Vector3.new(0,1,0) end
        if input.KeyCode == Enum.KeyCode.Q then move -= Vector3.new(0,-1,0) end
    end
end)

--[[
    CAMERA UPDATE LOOP
--]]
run.RenderStepped:Connect(function()
    if enabled then
        if looking then
            local delta = uis:GetMouseDelta()
            yaw -= delta.X * sensitivity
            pitch -= delta.Y * sensitivity
            pitch = math.clamp(pitch, -89, 89)
        end

        local pos = cam.CFrame.Position
        local rot = CFrame.fromOrientation(math.rad(pitch), math.rad(yaw), 0)
        cam.CFrame = CFrame.new(pos) * rot + (rot:VectorToWorldSpace(move) * speed)
    end
end)
